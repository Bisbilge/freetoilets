<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeToilet.com | Ücretsiz Tuvalet Bul</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { height: 100vh; width: 100%; }
        .info-box { padding: 10px; }
        .price-tag { color: #e74c3c; font-weight: bold; }
        .free-tag { color: #27ae60; font-weight: bold; }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    // Haritayı başlat (İstanbul merkezli)
    var map = L.map('map').setView([41.0082, 28.9784], 13);

    // Harita katmanını ekle (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // API'den verileri çek ve işaretçileri ekle
    fetch('/api/toilets/')
        .then(response => response.json())
        .then(data => {
            data.forEach(toilet => {
                var status = toilet.is_free ? 
                    '<span class="free-tag">Ücretsiz</span>' : 
                    `<span class="price-tag">Ücret: ${toilet.price} TL</span>`;

                var popupContent = `
                    <div class="info-box">
                        <h3>${toilet.name}</h3>
                        <p>${status}</p>
                        <p><b>Şifre:</b> <code>${toilet.code}</code></p>
                        <p>${toilet.desc}</p>
                    </div>
                `;

                L.marker([toilet.lat, toilet.lng]).addTo(map)
                    .bindPopup(popupContent);
            });
        })
        .catch(err => console.error("Veri yüklenemedi:", err));

    // Kullanıcının anlık konumunu bulma (Opsiyonel)
    map.locate({setView: true, maxZoom: 16});
</script>

</body>
</html>